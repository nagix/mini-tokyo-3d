{"version":3,"file":"mt3d-plugin-livecam.min.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.js","../node_modules/@fortawesome/fontawesome-free/svgs/solid/video.svg"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import {Marker, Panel, Popup} from 'mini-tokyo-3d';\nimport livecamSVG from '@fortawesome/fontawesome-free/svgs/solid/video.svg';\nimport './livecam.css';\n\n// Live camera URL\nconst LIVECAM_URL = 'https://mini-tokyo.appspot.com/livecam';\n\n// Refresh interval (5 minutes)\nconst REFRESH_INTERVAL = 300000;\n\nfunction addColor(url, color) {\n    const encodedColor = color.replace('#', '%23');\n    return url.replace('%3e', ` fill=\\'${encodedColor}\\' stroke=\\'${encodedColor}\\'%3e`);\n}\n\nfunction createElement(tagName, attributes, container) {\n    const element = document.createElement(tagName);\n\n    Object.assign(element, attributes);\n    if (container) {\n        container.appendChild(element);\n    }\n    return element;\n}\n\nclass LivecamPanel extends Panel {\n\n    constructor(options) {\n        super(Object.assign({className: 'livecam-panel'}, options));\n    }\n\n    addTo(map) {\n        const me = this,\n            {name, html} = me._options.camera;\n\n        me.setTitle(name[map.lang] || name.en)\n            .setHTML(html);\n        return super.addTo(map);\n    }\n\n}\n\nclass LivecamPlugin {\n\n    constructor() {\n        const me = this;\n\n        me.id = 'livecam';\n        me.name = {\n            de: 'Live-Kameras',\n            en: 'Live Cameras',\n            es: 'Cámaras en vivo',\n            fr: 'Caméras en direct',\n            ja: 'ライブカメラ',\n            ko: '실시간 웹캠',\n            ne: 'प्रत्यक्ष क्यामेरा',\n            pt: 'Câmeras ao vivo',\n            th: 'กล้องถ่ายทอดสด',\n            'zh-Hans': '实时摄像头',\n            'zh-Hant': '實時攝像頭'\n        };\n        me.iconStyle = {\n            backgroundSize: '32px',\n            backgroundImage: `url(\"${addColor(livecamSVG, 'white')}\")`\n        };\n        me.clockModes = ['realtime'];\n        me.viewModes = ['ground'];\n        me.cameras = {};\n        me._onSelection = me._onSelection.bind(me);\n        me._onDeselection = me._onDeselection.bind(me);\n    }\n\n    onAdd(map) {\n        this.map = map;\n    }\n\n    onEnabled() {\n        const me = this,\n            map = me.map;\n\n        map.on('selection', me._onSelection);\n        map.on('deselection', me._onDeselection);\n\n        const repeat = () => {\n            const now = performance.now();\n\n            if (Math.floor(now / REFRESH_INTERVAL) !== Math.floor(me._lastCameraRefresh / REFRESH_INTERVAL)) {\n                fetch(LIVECAM_URL)\n                    .then(response => response.json())\n                    .then(data => me._updateCameras(data));\n                me._lastCameraRefresh = now;\n            }\n            me._frameRequestID = requestAnimationFrame(repeat);\n        };\n\n        repeat();\n    }\n\n    onDisabled() {\n        const me = this,\n            {map, panel} = me;\n\n        map.off('selection', me._onSelection);\n        map.off('deselection', me._onDeselection);\n\n        if (panel) {\n            map.trackObject();\n            panel.remove();\n            delete me.panel;\n        }\n\n        cancelAnimationFrame(me._frameRequestID);\n        delete me._lastCameraRefresh;\n\n        me._updateCameras([]);\n    }\n\n    onVisibilityChanged(visible) {\n        const me = this,\n            {map, panel, cameras} = me;\n\n        me.visible = visible;\n\n        if (!visible && panel) {\n            map.trackObject();\n        }\n        for (const id of Object.keys(cameras)) {\n            cameras[id].marker.setVisibility(visible);\n        }\n    }\n\n    _updateCameras(data) {\n        const me = this,\n            {map, cameras, visible} = me,\n            lang = map.lang;\n\n        for (const item of data) {\n            const id = item.id,\n                camera = cameras[id];\n\n            if (camera) {\n                Object.assign(camera, item);\n                camera.marker.setLngLat(item.center);\n                camera.updated = true;\n                continue;\n            }\n\n            const element = createElement('div', {className: 'livecam-marker'}),\n                marker = new Marker({element, minZoom: 11})\n                    .setLngLat(item.center)\n                    .addTo(map)\n                    .setVisibility(visible)\n                    .on('click', () => {\n                        const {center, zoom, bearing, pitch} = cameras[id];\n\n                        map.trackObject({id, selectionType: 'livecam'});\n                        map.getMapboxMap().flyTo({center, zoom, bearing, pitch});\n                    })\n                    .on('mouseenter', () => {\n                        const {center, name, thumbnail} = cameras[id];\n\n                        cameras[id].popup = new Popup()\n                            .setLngLat(center)\n                            .setHTML([\n                                '<div class=\"thumbnail-image-container\">',\n                                '<div class=\"ball-pulse\"><div></div><div></div><div></div></div>',\n                                `<div class=\"thumbnail-image\" style=\"background-image: url(\\'${thumbnail}\\');\"></div>`,\n                                '</div>',\n                                `<div><strong>${name[lang] || name.en}</strong></div>`\n                            ].join(''))\n                            .addTo(map);\n                    })\n                    .on('mouseleave', () => {\n                        if (cameras[id].popup) {\n                            cameras[id].popup.remove();\n                            delete cameras[id].popup;\n                        }\n                    });\n\n            cameras[id] = Object.assign({marker, updated: true}, item);\n        }\n\n        for (const id of Object.keys(cameras)) {\n            if (cameras[id].updated) {\n                delete cameras[id].updated;\n            } else {\n                if (cameras[id].popup) {\n                    cameras[id].popup.remove();\n                }\n                cameras[id].marker.remove();\n                delete cameras[id];\n            }\n        }\n    }\n\n    _onSelection(event) {\n        if (event.selectionType === 'livecam') {\n            const me = this,\n                camera = me.cameras[event.id];\n\n            camera.marker.setActivity(true);\n            me.panel = new LivecamPanel({camera}).addTo(me.map);\n        }\n    }\n\n    _onDeselection(event) {\n        if (event.selectionType === 'livecam') {\n            const me = this,\n                camera = me.cameras[event.id],\n                panel = me.panel;\n\n            if (camera && camera.marker) {\n                camera.marker.setActivity(false);\n            }\n            if (panel) {\n                panel.remove();\n                delete me.panel;\n            }\n        }\n    }\n\n}\n\nexport default function() {\n    return new LivecamPlugin();\n}\n","var img = \"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'%3e%3c!--! Font Awesome Free 6.5.2 by %40fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0%2c Fonts: SIL OFL 1.1%2c Code: MIT License) Copyright 2024 Fonticons%2c Inc. --%3e%3cpath d='M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2V384c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64L416 337.1V320 192 174.9l14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z'/%3e%3c/svg%3e\";\n  export default img;"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","REFRESH_INTERVAL","addColor","url","color","encodedColor","replace","tagName","attributes","container","element","Object","assign","LivecamPanel","Panel","constructor","options","super","className","addTo","map","name","html","this","_options","camera","setTitle","lang","en","setHTML","LivecamPlugin","me","id","de","es","fr","ja","ko","ne","pt","th","iconStyle","backgroundSize","backgroundImage","clockModes","viewModes","cameras","_onSelection","bind","_onDeselection","onAdd","onEnabled","on","repeat","now","performance","Math","floor","_lastCameraRefresh","fetch","then","response","json","data","_updateCameras","_frameRequestID","requestAnimationFrame","onDisabled","panel","off","trackObject","remove","cancelAnimationFrame","onVisibilityChanged","visible","keys","marker","setVisibility","item","setLngLat","center","updated","Marker","minZoom","zoom","bearing","pitch","selectionType","getMapboxMap","flyTo","thumbnail","popup","Popup","join","event","setActivity"],"mappings":"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","x_google_ignoreList":[0,2]}