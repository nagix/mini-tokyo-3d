/*!
 * mt3d-plugin-livecam v1.3.2
 * https://minitokyo3d.com
 * (c) 2021-2025 Akihiko Kusanagi
 * Released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mini-tokyo-3d")):"function"==typeof define&&define.amd?define(["mini-tokyo-3d"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).mt3dLivecam=t(e.mt3d)}(this,(function(e){"use strict";!function(e,t){void 0===t&&(t={});var o=t.insertAt;if("undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===o&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(".livecam-panel{height:262px!important}.livecam-panel.collapsed{height:50px!important}.livecam-panel.closed{height:0!important}.livecam-marker{background:#fff no-repeat 50%/20px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512' fill='%23333'%3E%3C!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--%3E%3Cpath d='M0 128c0-35.3 28.7-64 64-64h256c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zm559.1-28.2c10.4 5.6 16.9 16.4 16.9 28.2v256c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64-14.2-9.5V174.9l14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z'/%3E%3C/svg%3E\");border:2px solid #333;border-radius:50%;cursor:pointer;height:40px;width:40px}.livecam-marker.active,.livecam-marker:hover{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512' fill='%2333B5E5'%3E%3C!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--%3E%3Cpath d='M0 128c0-35.3 28.7-64 64-64h256c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zm559.1-28.2c10.4 5.6 16.9 16.4 16.9 28.2v256c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64-14.2-9.5V174.9l14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z'/%3E%3C/svg%3E\");border-color:#33b5e5}");const t=3e5;function o(e,t){const o=t.replace("#","%23");return e.replace("%3e",` fill='${o}' stroke='${o}'%3e`)}function n(e,t,o){const n=document.createElement(e);return Object.assign(n,t),n}class s extends e.Panel{constructor(e){super(Object.assign({className:"livecam-panel"},e))}addTo(e){const{name:t,html:o}=this._options.camera;return this.setTitle(t[e.lang]||t.en).setHTML(o),super.addTo(e)}}class a{constructor(){const e=this;e.id="livecam",e.name={de:"Live-Kameras",en:"Live Cameras",es:"Cámaras en vivo",fr:"Caméras en direct",ja:"ライブカメラ",ko:"실시간 웹캠",ne:"प्रत्यक्ष क्यामेरा",pt:"Câmeras ao vivo",th:"กล้องถ่ายทอดสด","zh-Hans":"实时摄像头","zh-Hant":"實時攝像頭"},e.iconStyle={backgroundSize:"32px",backgroundImage:`url("${o("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'%3e%3c!--! Font Awesome Free 6.5.2 by %40fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0%2c Fonts: SIL OFL 1.1%2c Code: MIT License) Copyright 2024 Fonticons%2c Inc. --%3e%3cpath d='M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2V384c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64L416 337.1V320 192 174.9l14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z'/%3e%3c/svg%3e","white")}")`},e.clockModes=["realtime"],e.viewModes=["ground"],e.cameras={},e._onSelection=e._onSelection.bind(e),e._onDeselection=e._onDeselection.bind(e)}onAdd(e){this.map=e}onEnabled(){const e=this,o=e.map;o.on("selection",e._onSelection),o.on("deselection",e._onDeselection);const n=()=>{const o=performance.now();Math.floor(o/t)!==Math.floor(e._lastCameraRefresh/t)&&(fetch("https://mini-tokyo.appspot.com/livecam").then((e=>e.json())).then((t=>e._updateCameras(t))),e._lastCameraRefresh=o),e._frameRequestID=requestAnimationFrame(n)};n()}onDisabled(){const e=this,{map:t,panel:o}=e;t.off("selection",e._onSelection),t.off("deselection",e._onDeselection),o&&(t.trackObject(),o.remove(),delete e.panel),cancelAnimationFrame(e._frameRequestID),delete e._lastCameraRefresh,e._updateCameras([])}onVisibilityChanged(e){const{map:t,panel:o,cameras:n}=this;this.visible=e,!e&&o&&t.trackObject();for(const t of Object.keys(n))n[t].marker.setVisibility(e)}_updateCameras(t){const{map:o,cameras:s,visible:a}=this,i=o.lang;for(const c of t){const t=c.id,r=s[t];if(r){Object.assign(r,c),r.marker.setLngLat(c.center),r.updated=!0;continue}const l=n("div",{className:"livecam-marker"}),m=new e.Marker({element:l,minZoom:11}).setLngLat(c.center).addTo(o).setVisibility(a).on("click",(()=>{const{center:e,zoom:n,bearing:a,pitch:i}=s[t];o.trackObject({id:t,selectionType:"livecam"}),o.getMapboxMap().flyTo({center:e,zoom:n,bearing:a,pitch:i})})).on("mouseenter",(()=>{const{center:n,name:a,thumbnail:c}=s[t];s[t].popup=(new e.Popup).setLngLat(n).setHTML(['<div class="thumbnail-image-container">','<div class="ball-pulse"><div></div><div></div><div></div></div>',`<div class="thumbnail-image" style="background-image: url('${c}');"></div>`,"</div>",`<div><strong>${a[i]||a.en}</strong></div>`].join("")).addTo(o)})).on("mouseleave",(()=>{s[t].popup&&(s[t].popup.remove(),delete s[t].popup)}));s[t]=Object.assign({marker:m,updated:!0},c)}for(const e of Object.keys(s))s[e].updated?delete s[e].updated:(s[e].popup&&s[e].popup.remove(),s[e].marker.remove(),delete s[e])}_onSelection(e){if("livecam"===e.selectionType){const t=this,o=t.cameras[e.id];o.marker.setActivity(!0),t.panel=new s({camera:o}).addTo(t.map)}}_onDeselection(e){if("livecam"===e.selectionType){const t=this,o=t.cameras[e.id],n=t.panel;o&&o.marker&&o.marker.setActivity(!1),n&&(n.remove(),delete t.panel)}}}return function(){return new a}}));
//# sourceMappingURL=mt3d-plugin-livecam.min.js.map
