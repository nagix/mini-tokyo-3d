{"version":3,"file":"mt3d-plugin-hotels.min.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.js","../node_modules/@fortawesome/fontawesome-free/svgs/solid/bed.svg"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import {Marker, Panel, Popup} from 'mini-tokyo-3d';\nimport hotelSVG from '@fortawesome/fontawesome-free/svgs/solid/bed.svg';\nimport './hotels.css';\n\n// Hotel info URL\nconst HOTELS_URL = 'https://mini-tokyo.appspot.com/hotels';\n\nfunction addColor(url, color) {\n    const encodedColor = color.replace('#', '%23');\n    return url.replace('%3e', ` fill=\\'${encodedColor}\\' stroke=\\'${encodedColor}\\'%3e`);\n}\n\nfunction createElement(tagName, attributes, container) {\n    const element = document.createElement(tagName);\n\n    Object.assign(element, attributes);\n    if (container) {\n        container.appendChild(element);\n    }\n    return element;\n}\n\nclass HotelPanel extends Panel {\n\n    constructor(options) {\n        super(Object.assign({className: 'hotel-panel'}, options));\n    }\n\n    addTo(map) {\n        const me = this,\n            {name, address, phone, url, thumbnail} = me._options.hotel;\n\n        super.addTo(map)\n            .setTitle(name)\n            .setHTML([\n                '<div class=\"thumbnail-image-container\">',\n                '<div class=\"ball-pulse\"><div></div><div></div><div></div></div>',\n                `<div class=\"thumbnail-image\" style=\"background-image: url(\\'${thumbnail}\\');\"></div>`,\n                '</div>',\n                `<div style=\"margin-top: 8px;\"><span style=\"font-weight: bold;\">住所</span>: ${address}</div>`,\n                `<div style=\"margin-top: 4px;\"><span style=\"font-weight: bold;\">電話番号</span>: ${phone}</div>`,\n                '<div style=\"margin-top: 4px;\"><span style=\"font-weight: bold;\">空室あり</span></div>',\n                '<div id=\"booking-button\" style=\"width: 100%; height: 39px; margin: 8px 0 1px 0; border-radius: 10px; box-shadow:0 0 0 1px #777; line-height: 39px; text-align: center; cursor: pointer;\">プランを見る</div>'\n            ].join(''));\n\n        const bookingButtonElement = me._container.querySelector('#booking-button');\n        bookingButtonElement.addEventListener('click', () => {\n            open(url, '_blank');\n        });\n\n        return me;\n    }\n\n}\n\nclass HotelsPlugin {\n\n    constructor() {\n        const me = this;\n\n        me.id = 'hotels';\n        me.name = {\n            en: 'Hotel Info For Last Train Passengers',\n            fr: 'Infos Sur Les Hôtels',\n            ja: '終電ホテル情報',\n            ko: '종전 호텔 정보',\n            ne: 'होटल जानकारी',\n            pt: 'Informações de hotéis',\n            th: 'ข้อมูลโรงแรม',\n            'zh-Hans': '末班车酒店信息',\n            'zh-Hant': '末班車飯店資訊'\n        };\n        me.iconStyle = {\n            backgroundSize: '32px',\n            backgroundImage: `url(\"${addColor(hotelSVG, 'white')}\")`\n        };\n        me.clockModes = ['realtime'];\n        me.viewModes = ['ground'];\n        me.hotels = {};\n        me.markers = {};\n        me._onSelection = me._onSelection.bind(me);\n        me._onDeselection = me._onDeselection.bind(me);\n    }\n\n    onAdd(map) {\n        this.map = map;\n    }\n\n    onEnabled() {\n        const me = this,\n            {map, hotels} = me;\n\n        map.on('selection', me._onSelection);\n        map.on('deselection', me._onDeselection);\n\n        fetch(HOTELS_URL).then(response => response.json()).then(data => {\n            for (const item of data) {\n                hotels[item.id] = item;\n            }\n            me._addMarkers();\n        });\n    }\n\n    onDisabled() {\n        const me = this,\n            {map} = me;\n\n        map.off('selection', me._onSelection);\n        map.off('deselection', me._onDeselection);\n\n        if (me.panel) {\n            map.trackObject();\n            me.panel.remove();\n            delete me.panel;\n        }\n\n        for (const id of Object.keys(me.hotels)) {\n            delete me.hotels[id];\n        }\n        for (const id of Object.keys(me.markers)) {\n            me.markers[id].remove();\n            delete me.markers[id];\n        }\n    }\n\n    onVisibilityChanged(visible) {\n        const me = this;\n\n        me.visible = visible;\n\n        if (!visible && me.panel) {\n            me.map.trackObject();\n        }\n        for (const id of Object.keys(me.markers)) {\n            me.markers[id].setVisibility(visible);\n        }\n    }\n\n    _addMarkers() {\n        const me = this,\n            {map, visible} = me,\n            {lang} = map;\n\n        for (const id of Object.keys(me.hotels)) {\n            const {center, name, thumbnail} = me.hotels[id],\n                element = createElement('div', {className: 'hotel-marker'}),\n                selection = {id, selectionType: 'hotel'};\n            let popup;\n\n            me.markers[id] = new Marker({element})\n                .setLngLat(center)\n                .addTo(map)\n                .setVisibility(visible)\n                .on('click', () => {\n                    map.trackObject(selection);\n                    map.getMapboxMap().flyTo({center, zoom: 17});\n                })\n                .on('mouseenter', () => {\n                    popup = new Popup()\n                        .setLngLat(center)\n                        .setHTML([\n                            '<div class=\"thumbnail-image-container\">',\n                            '<div class=\"ball-pulse\"><div></div><div></div><div></div></div>',\n                            `<div class=\"thumbnail-image\" style=\"background-image: url(\\'${thumbnail}\\');\"></div>`,\n                            '</div>',\n                            `<div><strong>${name}</strong></div>`\n                        ].join(''))\n                        .addTo(map);\n                })\n                .on('mouseleave', () => {\n                    if (popup) {\n                        popup.remove();\n                        popup = undefined;\n                    }\n                });\n        }\n    }\n\n    _onSelection(event) {\n        if (event.selectionType === 'hotel') {\n            const me = this,\n                {id} = event;\n\n            me.markers[id].setActivity(true);\n            me.panel = new HotelPanel({hotel: me.hotels[id]}).addTo(me.map);\n        }\n    }\n\n    _onDeselection(event) {\n        if (event.selectionType === 'hotel') {\n            const me = this,\n                marker = me.markers[event.id];\n\n            if (marker) {\n                marker.setActivity(false);\n            }\n            if (me.panel) {\n                me.panel.remove();\n                delete me.panel;\n            }\n        }\n    }\n\n}\n\nexport default function() {\n    return new HotelsPlugin();\n}\n","var img = \"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512'%3e%3c!--! Font Awesome Free 6.5.2 by %40fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0%2c Fonts: SIL OFL 1.1%2c Code: MIT License) Copyright 2024 Fonticons%2c Inc. --%3e%3cpath d='M32 32c17.7 0 32 14.3 32 32V320H288V160c0-17.7 14.3-32 32-32H544c53 0 96 43 96 96V448c0 17.7-14.3 32-32 32s-32-14.3-32-32V416H352 320 64v32c0 17.7-14.3 32-32 32s-32-14.3-32-32V64C0 46.3 14.3 32 32 32zm144 96a80 80 0 1 1 0 160 80 80 0 1 1 0-160z'/%3e%3c/svg%3e\";\n  export default img;"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","addColor","url","color","encodedColor","replace","tagName","attributes","container","element","Object","assign","HotelPanel","Panel","constructor","options","super","className","addTo","map","me","this","name","address","phone","thumbnail","_options","hotel","setTitle","setHTML","join","_container","querySelector","addEventListener","open","HotelsPlugin","id","en","fr","ja","ko","ne","pt","th","iconStyle","backgroundSize","backgroundImage","clockModes","viewModes","hotels","markers","_onSelection","bind","_onDeselection","onAdd","onEnabled","on","fetch","then","response","json","data","item","_addMarkers","onDisabled","off","panel","trackObject","remove","keys","onVisibilityChanged","visible","setVisibility","center","selection","selectionType","popup","Marker","setLngLat","getMapboxMap","flyTo","zoom","Popup","undefined","event","setActivity","marker"],"mappings":"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","x_google_ignoreList":[0,2]}